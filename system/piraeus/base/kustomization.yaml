apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: piraeus-datastore

resources:
- ca-bootstrapper.yaml
- internal-ca.yaml
- api-ca.yaml
- https://github.com/piraeusdatastore/piraeus-operator/config/default?ref=v2.5.1
- cluster.yaml
- satellite-internal-tls.yaml
- satellite-pools.yaml
- storageclasses.yaml
- talos-loader-overrides.yaml

patches:
- patch: |- # Sync cert-manager resources after initial operator
    - op: add
      path: /metadata/annotations
      value:
        argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
        argocd.argoproj.io/sync-wave: "1"
  target:
    group: cert-manager.io
- patch: |- # Sync piraeus resources after all prerequisite CRDs
    - op: add
      path: /metadata/annotations
      value:
        argocd.argoproj.io/sync-wave: "1"
  target:
    group: piraeus.io
