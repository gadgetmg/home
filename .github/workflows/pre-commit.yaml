name: pre-commit
run-name: pre-commit
on:
  push:
    branches:
    - main
  pull_request:
jobs:
  main:
    runs-on: ubuntu-24.04
    steps:
    - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      with:
        token: ${{ secrets.PRECOMMIT_PAT }}
    - uses: nixbuild/nix-quick-install-action@25aff27c252e0c8cdda3264805f7b6bcd92c8718 # v29
    - uses: DeterminateSystems/magic-nix-cache-action@87b14cf437d03d37989d87f0fa5ce4f5dc1a330b # v8
      with:
        use-flakehub: false
    - uses: nicknovitski/nix-develop@9be7cfb4b10451d3390a75dc18ad0465bed4932a # v1.2.1
      with:
        arguments: .#ci
    - uses: actions/cache@1bd1e32a3bdc45362d1e726936510720a7c30a57 # v4.2.0
      id: cache-task-checksums
      with:
        path: ./.task/
        key: .task-${{ github.ref_name }}-${{ hashFiles('**/*') }}
        restore-keys: |
          .task-${{ github.ref_name }}-
          .task-
    - run: SKIP=no-commit-to-branch pre-commit run --all-files
    - uses: stefanzweifel/git-auto-commit-action@e348103e9026cc0eee72ae06630dbe30c8bf7a79 # v5.1.0
      if: always()
      with:
        commit_message: '[pre-commit] automatic fixes'
