# yaml-language-server: $schema=https://raw.githubusercontent.com/budimanjojo/talhelper/v3.0.29/pkg/config/schemas/talconfig.json
clusterName: production
# renovate: datasource=github-releases depName=siderolabs/talos
talosVersion: v1.10.4
# renovate: datasource=github-releases depName=kubernetes/kubernetes
kubernetesVersion: v1.33.2
endpoint: https://10.1.2.10:6443
nodes:
- hostname: production-controlplane-1
  ipAddress: 100.120.217.123
  certSANs:
  - 10.1.2.11
  networkInterfaces:
  - interface: br0
    # dhcp: true
    addresses:
    - 10.1.2.11/24
    bridge:
      stp:
        enabled: true
      interfaces:
      - eno1
    routes:
    - network: 0.0.0.0/0
      gateway: 10.1.2.1
    vip:
      ip: 10.1.2.10
  installDisk: /dev/nvme0n1
  controlPlane: true
- hostname: production-controlplane-2
  ipAddress: 100.96.204.17
  certSANs:
  - 10.1.2.12
  networkInterfaces:
  - interface: br0
    # dhcp: true
    addresses:
    - 10.1.2.12/24
    bridge:
      stp:
        enabled: true
      interfaces:
      - eno1
    routes:
    - network: 0.0.0.0/0
      gateway: 10.1.2.1
    vip:
      ip: 10.1.2.10
  installDisk: /dev/nvme0n1
  controlPlane: true
- hostname: production-controlplane-3
  ipAddress: 100.101.252.23
  certSANs:
  - 10.1.2.13
  networkInterfaces:
  - interface: br0
    # dhcp: true
    addresses:
    - 10.1.2.13/24
    bridge:
      stp:
        enabled: true
      interfaces:
      - eno1
    routes:
    - network: 0.0.0.0/0
      gateway: 10.1.2.1
    vip:
      ip: 10.1.2.10
  installDisk: /dev/nvme0n1
  controlPlane: true
cniConfig:
  name: none
allowSchedulingOnControlPlanes: true
controlPlane:
  nameservers:
  - 10.1.2.1
  talosImageURL: factory.talos.dev/installer-secureboot/59a4a77747c72d3ccb71981770dd71a1cd38b9e17805b3e81774171e9cc112e5
  extensionServices:
  - name: tailscale
    environment:
    - TS_AUTHKEY=${TS_AUTHKEY}
    - TS_ROUTES=10.1.2.10/32
    - TS_ACCEPT_DNS=true
    - TS_AUTH_ONCE=true
  kernelModules:
  - name: drbd
    parameters:
    - usermode_helper=disabled
  - name: drbd_transport_tcp
  - name: dm-thin-pool
  patches:
  - '@clusterconfig/patches/disk-encryption.yaml'
  - '@clusterconfig/patches/metrics-scraping.yaml'
  - '@clusterconfig/patches/disable-proxy.yaml'
  - '@clusterconfig/patches/disable-hostdns.yaml'
  - '@clusterconfig/patches/containerd-config.yaml'
  - '@clusterconfig/patches/oidc.yaml'
  - '@clusterconfig/patches/pod-security.yaml'
